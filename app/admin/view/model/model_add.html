{extend name="public/base" /}
{block name="main-content"}
	<div class="page-content">
		<link rel="stylesheet" href="__PUBLIC__/bootstrap-select/css/bootstrap-select.min.css">
		<!--主题-->
		<div class="page-header">
			<h1>
				您当前操作
				<small>
					<i class="ace-icon fa fa-angle-double-right"></i>
					添加模型
				</small>
			</h1>
		</div>
		<div class="row">
			<div class="col-xs-12">
				<form class="form-horizontal modelform" name="model_add" method="post" action="{:url('model_runadd')}">
					<div class="form-group">
						<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 模型标识：  </label>
						<div class="col-sm-10">
							<input type="text" name="model_name" id="model_name" placeholder="输入模型标识" class="col-xs-10 col-sm-4" required/>
							<span class="lbl">&nbsp;&nbsp;<span class="red">*</span>必填，标识必须是以字母开头、数字组合</span>
						</div>
					</div>
					<div class="space-4"></div>
					<div class="form-group">
						<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 模型标题：  </label>
						<div class="col-sm-10">
							<input type="text" name="model_title" id="model_title" placeholder="输入模型标题" class="col-xs-10 col-sm-4" required/>
							<span class="lbl">&nbsp;&nbsp;<span class="red">*</span>必填,可以英文和中文</span>
						</div>
					</div>
					<div class="space-4"></div>
					
					<div class="form-group">
						<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 引擎类型： </label>
						<div class="col-sm-10">
							<select name="model_engine"  class="col-sm-4 selector" required>
								<option value="">请选择数据引擎类型</option>
								<option value="MyISAM">MyISAM</option>
								<option value="InnoDB">InnoDB</option>
                                <option value="MEMORY">MEMORY</option>
                                <option value="BLACKHOLE">BLACKHOLE</option>
                                <option value="MRG_MYISAM">MRG_MYISAM</option>
                                <option value="ARCHIVE">ARCHIVE</option>
							</select>
							<span class="lbl">&nbsp;&nbsp;<span class="red">*</span>必选</span>
						</div>
					</div>
					<div class="space-4"></div>

					<div class="form-group">
						<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 字段列表：  </label>
						
						<label class="col-sm-1 control-label" style="text-align:left" >
							<a class="purple new-row" href="" data-toggle="modal" data-target="#myModal" title="插入">
								<i class="ace-icon fa fa-plus-circle bigger-130"></i>
							</a>
						</label>
						<div class="col-sm-11">
							<table class="table table-striped table-bordered table-hover" id="dynamic-table">
								<thead>
								<tr>
									<th>字段名</th>
									<th>字段标题</th>
									<th>字段类型</th>
									<th class="hidden-sm hidden-xs">字段数据</th>
									<th class="hidden-sm hidden-xs">字段说明</th>
									<th class="hidden-sm hidden-xs">字段长度</th>
									<th>字段规则</th>
									<th class="hidden-sm hidden-xs">默认值</th>
									<th style="border-right:#CCC solid 1px;">操作</th>
								</tr>
								</thead>

								<tbody id="fields-data">
								</tbody>
							</table>
						</div>
					</div>
					<div class="space-4"></div>

					<div class="form-group">
						<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 是否启用： </label>
						<div class="col-sm-10" style="padding-top:5px;">
							<input name="model_status" id="model_status" value="1" class="ace ace-switch ace-switch-4 btn-flat" type="checkbox" checked/>
							<span class="lbl">&nbsp;&nbsp;默认启用</span>
						</div>
					</div>
					<div class="space-4"></div>


					<div class="clearfix form-actions">
						<div class="col-md-offset-3 col-md-9">
							<button class="btn btn-info" type="submit">
								<i class="ace-icon fa fa-check bigger-110"></i>
								保存
							</button>

							&nbsp; &nbsp; &nbsp;
							<button class="btn" type="reset">
								<i class="ace-icon fa fa-undo bigger-110"></i>
								重置
							</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		<!-- 显示添加模态框（Modal） -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"
								aria-hidden="true">×
						</button>
						<h4 class="modal-title" id="myModalLabel">
							添加字段
						</h4>
					</div>
					<div class="modal-body">


						<div class="row">
							<div class="col-xs-12">
								<div class="form-group">
									<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 字段名称：  </label>
									<div class="col-sm-10">
										<input type="text" name="field_name" id="field_name" placeholder="输入字段名称" class="col-xs-10 col-sm-5" required/><span class="lbl">*必填 以英文开头</span>
									</div>
								</div>
								<div class="space-4 col-xs-12"></div>
								<div class="form-group">
									<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 字段标题：  </label>
									<div class="col-sm-10">
										<input type="text" name="field_title" id="field_title" placeholder="输入字段标题" class="col-xs-10 col-sm-5" required/><span class="lbl">*必填</span>
									</div>
								</div>
								<div class="space-4 col-xs-12"></div>
								<div class="form-group">
									<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 字段类型：  </label>
									<div class="col-sm-10">
										<select name="field_type"  id="field_type" class="col-xs-10 col-sm-5 selector" required>
											<option value="">请选择字段类型</option>
											<option value="text">文本</option>
											<option value="imagefile">单图片</option>
											<option value="images">多图片</option>
											<option value="selecttext">选择文本</option>
											<option value="currency">货币</option>
											<option value="large_number">长整数</option>
											<option value="number">整数</option>
											<option value="datetime">日期时间</option>
											<option value="date">日期</option>
											<option value="selectnumber">选择数字</option>
											<option value="richtext">富文本</option>
											<option value="bigtext">文本域</option>
											<option value="switch">开关</option>
											<option value="checkbox">多选框</option>
										</select>
										<span class="lbl">*必选</span>
									</div>
								</div>
								<div class="space-4 col-xs-12"></div>
								<div id="input_data">
									<div class="form-group">
										<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 字段数据：  </label>
										<div class="col-sm-10">
											<input type="text" name="field_data" id="field_data" placeholder="输入字段数据" class="col-xs-10 col-sm-5"/><span class="lbl">格式:'1:text1,2:text2,3:text3'或'数据表名|值字段名|标题字段名(|排序字段)'</span>
										</div>
									</div>
									<div class="space-4 col-xs-12"></div>
								</div>
								<div id="input_length">
									<div class="form-group">
										<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 字段长度：  </label>
										<div class="col-sm-10">
											<input type="text" name="field_length" id="field_length" placeholder="输入字段长度" class="col-xs-10 col-sm-5"/><span class="lbl"></span>
										</div>
									</div>
									<div class="space-4 col-xs-12"></div>
								</div>
								<div id="input_default">
									<div class="form-group">
										<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 字段默认值：  </label>
										<div class="col-sm-10">
											<input type="text" name="field_default" id="field_default" placeholder="输入字段默认值" class="col-xs-10 col-sm-5"/><span class="lbl"></span>
										</div>
									</div>
									<div class="space-4 col-xs-12"></div>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 字段说明：  </label>
									<div class="col-sm-10">
										<input type="text" name="field_desc" id="field_desc" placeholder="输入字段说明" class="col-xs-10 col-sm-5"/><span class="lbl"></span>
									</div>
								</div>
								<div class="space-4 col-xs-12"></div>
								<div class="form-group">
									<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 字段规则：</label>
									<div class="col-sm-10">
										<select class="selectpicker" multiple data-width="fit">
										  <option title="lengthfixed">定长</option>
										  <option title="required">非空</option>
										  <option title="unsigned">非负</option>
										  <option title="unique">唯一</option>
										</select>
									</div>
								</div>
							</div>
						</div>

					</div>
					<div class="modal-footer">
						<button type="submit" class="btn btn-primary insert-field">
							确认
						</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">
							关闭
						</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div><!-- /.page-content -->
{/block}
{block name="scripts"}
<script src="__PUBLIC__/bootstrap-select/js/bootstrap-select.min.js"></script>
<script>
$(function () {
	var $data_arr=['selecttext','checkbox','selectnumber'];
	$("#input_data").hide();
	$("#input_length").hide();
	$("#input_default").hide();
	//插入到尾部
    $('.insert-field').click(function () {
        var $table=$('#fields-data'),
			$field_name = $('#field_name').val(),
			$field_title = $('#field_title').val(),
			$field_type = $('#field_type').val(),
			$html ='';
		if($field_name=='' || $field_title=='' || $field_type==''){
			layer.alert('字段名、字段标题、字段类型不能为空', {icon: 5}, function (index) {
				layer.close(index);
			});
		}else{
			$field_data = $('#field_data').val(),
			$field_length = $('#field_length').val(),
			$field_default = $('#field_default').val(),
			$field_desc = $('#field_desc').val(),
			$field_rules = ($('.filter-option').html()=='Nothing selected')?'':$('.filter-option').html();
			$html='<tr><td>'+$field_name+'</td><td>'+$field_title+'</td><td>'+$field_type+'</td><td class="hidden-sm hidden-xs">'+$field_data+'</td><td class="hidden-sm hidden-xs">'+$field_desc+'</td><td class="hidden-sm hidden-xs">'+$field_length+'</td><td>'+$field_rules+'</td><td class="hidden-sm hidden-xs">'+$field_default+'</td><td style="border-right:#CCC solid 1px;">操作</td></tr>';	
			$table.append($html);
			$('#myModal').modal('hide');
		}
    });
	//隐藏模态框时清空,removeData无效,不清楚为啥
	$('#myModal').on('hide.bs.modal', function () {
		$('#field_name').val('');
		$('#field_title').val('');
		$('#field_type').val('');
		$('#field_data').val('');
		$('#field_length').val('');
		$('#field_default').val('');
		$('#field_desc').val('');
		$('.selectpicker').selectpicker('deselectAll');
	});
	//字段类型选择时,动态显示表单
	$('#field_type').change(function () {
		var $type=$(this).val();
		if($.inArray($type, $data_arr)>-1){
			$("#input_data").show(400);
			$("#input_length").hide(400);
		}else if($type == 'text'){
			$("#input_data").hide(400);
			$("#input_length").show(400);
		}else{
			$("#input_data").hide(400);
			$("#input_length").hide(400);
		}
		//是否图片
		if($type=='imagefile' || $type=='images'){
			$("#input_default").hide(400);
		}else{
			$("#input_default").show(400);
		}
	});
});
</script>
{/block}
